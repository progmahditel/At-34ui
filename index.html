<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Basic Crypto Candlestick Chart with Watermark</title>
<script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.0.0/dist/lightweight-charts.standalone.production.js"></script>
<style>
  body {
    margin: 0;
    background: #0a0a0a;
    font-family: Arial, sans-serif;
    color: #d4af37;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    height: 100vh;
    padding: 10px;
    position: relative;
  }
  #chart-header {
    text-align: center;
    margin-bottom: 12px;
  }
  #chart-header h2 {
    margin: 0;
    font-size: 1.5rem;
  }
  #chart-header p {
    margin: 4px 0;
    font-size: 1rem;
  }
  #chart-container {
    position: relative;
    width: 95vw;
    max-width: 900px;
  }
  #chart {
    width: 100%;
    height: 500px;
    border-radius: 12px;
    box-shadow:
      0 0 20px rgba(212,175,55,0.3),
      inset 0 0 10px rgba(212,175,55,0.15);
    position: relative;
  }
  /* واترمارک لوگو راست بالا */
  #watermark-logo {
    position: absolute;
    top: 12px;
    right: 14%;
    z-index: 10;
    opacity: 0.4;
    transition: opacity 0.3s ease;
    pointer-events: auto;
    width: clamp(60px, 8vw, 90px);
  }
  #watermark-logo:hover {
    opacity: 1;
  }
  #watermark-logo img {
    width: 100%;
    height: auto;
    display: block;
  }
  /* واترمارک متن زیر چارت وسط */
  #watermark-text {
    margin-top: 8px;
    text-align: center;
    font-size: 0.85rem;
    color: rgba(212,175,55,0.6);
    user-select: none;
  }
</style>
</head>
<body>

<div id="chart-header">
  <h2 id="chart-symbol">Loading...</h2>
  <p>Price: <span id="chart-price">--</span> USDT</p>
  <p>Interval: <span id="chart-interval">--</span></p>
  <p>Last Candle Close Time (UTC): <span id="chart-time">--</span></p>
</div>

<div id="chart-container">
  <div id="chart"></div>
  <a id="watermark-logo" href="https://t.me/EternalMagazine" target="_blank" rel="noopener noreferrer" title="EternalMagazine">
    <img src="https://iili.io/FiFM6eS.png" alt="Watermark Logo" />
  </a>
  <div id="watermark-text">t.me/EternalMagazine</div>
</div>

<script>
  // تایم فریم‌های معتبر بایننس
  const validIntervals = new Set([
    '1m', '3m', '5m', '15m', '30m',
    '1h', '2h', '4h', '6h', '8h', '12h',
    '1d', '3d', '1w', '1M'
  ]);

  // گرفتن پارامترها از URL
  const params = new URLSearchParams(window.location.search);
  let symbol = (params.get('symbol') || 'BTC').toUpperCase();
  let interval = (params.get('interval') || '1d').toLowerCase();

  if (!validIntervals.has(interval)) {
    interval = '1d';
  }

  document.getElementById('chart-symbol').textContent = `${symbol}/USDT`;
  document.getElementById('chart-interval').textContent = interval;

  // ساخت چارت
  const chartDiv = document.getElementById('chart');
  const chart = LightweightCharts.createChart(chartDiv, {
    layout: {
      background: { type: 'solid', color: '#0a0a0a' },
      textColor: '#d4af37',
    },
    grid: {
      vertLines: { color: '#3f2e0077' },
      horzLines: { color: '#3f2e0077' }
    },
    rightPriceScale: { borderColor: '#bfa84b' },
    timeScale: { borderColor: '#bfa84b', timeVisible: true, secondsVisible: false }
  });

  const candlestickSeries = chart.addCandlestickSeries({
    upColor: '#d4af37',
    downColor: '#ff4f81',
    wickUpColor: '#d4af37',
    wickDownColor: '#ff4f81'
  });

  async function fetchCandles() {
    const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}USDT&interval=${interval}&limit=150`;
    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error('Bad Response');
      const data = await res.json();
      if (!Array.isArray(data) || data.length === 0) throw new Error('Invalid Symbol or No Data');

      const candles = data.map(d => ({
        time: Math.floor(d[0] / 1000),
        open: parseFloat(d[1]),
        high: parseFloat(d[2]),
        low: parseFloat(d[3]),
        close: parseFloat(d[4])
      }));

      candlestickSeries.setData(candles);

      const lastClose = candles[candles.length - 1]?.close || '--';
      document.getElementById('chart-price').textContent = lastClose;

      const lastCloseTime = data[data.length - 1][6];
      document.getElementById('chart-time').textContent = new Date(lastCloseTime).toUTCString();

    } catch (e) {
      document.getElementById('chart-symbol').textContent = 'Invalid Symbol or Interval';
      document.getElementById('chart-price').textContent = '--';
      document.getElementById('chart-time').textContent = '--';
    }
  }

  fetchCandles();
  setInterval(fetchCandles, 4000);
</script>

</body>
</html> 